<!DOCTYPE html>
<html>
  <head>
    <title> Test GUI API </title>
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="./jquery/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="./scripts/BarcoUtil.js" type="text/javascript"></script>
    <script src="./scripts/Request.js" type="text/javascript"></script>	
    <script src="./scripts/ServiceAgent.js" type="text/javascript"></script>
    <script src="./scripts/SessionAgent.js" type="text/javascript"></script>
    <script src="./scripts/SessionInfo.js" type="text/javascript"></script>
    <script src="./scripts/SessionAPI.js" type="text/javascript"></script>
    <script src="./scripts/BarcoAPI.js" type="text/javascript"></script>
  </head>
  <body>
    <div>
      <h1><span>Test GUI API</span></h1>
      <div>
        <span><input type="text" id="txtUsername" placeholder="UserName" /></span>
        <span><input type="text" id="txtPwd" placeholder="Password" /></span>
        <span><input type="text" id="txtServer" placeholder="Server IP Address" /></span>
        <span><input type="text" id="txtResource" value="web-client" /></span>
        <span><input type="button" id="btnLogin" value="Login" /></span>
        <span><input type="button" id="btnLogout" value="Logout" /></span>
      </div>
      <div>
      
        <br /><br />
      <span><input type="button" id="btnGetPort" value="GetPort" /></span>
      <span><input type="button" id="btnGetAuthInfo" value="GetAuthInfo" /></span>
      <span><input type="button" id="btnGetPortWithToken" value="GetPortWithToken" /></span> 
      <br /><br />
     </div>
    </div>
    <div style="position:absolute;width:55%; top:180px;" id="divResponse"><span><textarea id="notification" name="request" rows="48" cols="123"></textarea></span></div><div id="codeSnippet" contenteditable style="position:absolute;width:45%; top:180px;right:10px"></div>
    <script>
      jQuery(document).ready(function () {
        //Init barco API
        var agent = new BarcoAPI();

        //Register callback to get updates(Notifications)
        agent.registerCallback(function (eventName, eventData) {
          var eventStr = eventName;
          var eventVal = eventData;
        });

        var protocol = location.protocol;
        var ipAddress = location.host;
        var authToken = null;

        /**login
         * Validate all fields for null
         * call .doLogin API with following params
         * userName
         * password
         * protocal (http:/https:)
         * serverIP
         * seviceVersion
         * callback 
         * Callback will be called with response object {State:"SUCCESS/ERROR", Error: { Code: "", Desc: ""}}
        */
        function login() {
          //Check for username
          var userName = jQuery('#txtUsername').val();
          if (jQuery.isBlank(userName)) {
            alert("Username cannot be empty");
            return
          }
          //Check for password
          var password = jQuery('#txtPwd').val();
          if (jQuery.isBlank(password)) {
            alert("Password cannot be empty");
            return
          }
          //Check for serverIP
          var serverIP = jQuery('#txtServer').val();
          if (jQuery.isBlank(serverIP)) {
            alert("Server IP cannot be empty");
            return
          }
          //Check for resource
          var resource = jQuery('#txtResource').val();
          if (jQuery.isBlank(resource)) {
            alert("Resource cannot be empty");
            return
          }

          var snippetStr = "<pre><U>Login:</U><br><br>barcoAPI.doLogin(userName, password, protocol, serverIP, resource, serviceVersion, function (response) {<br>"
          snippetStr += "  if (response.State == 'SUCCESS') {<br>";
          snippetStr += "    console.log('Login Success')<br>";
          snippetStr += "  }<br>";
          snippetStr += "  else {<br>"
          snippetStr += "    console.log('Login Failed')<br>";
          snippetStr += "  }<br>"
          snippetStr += "});</br></pre>"
          jQuery('#codeSnippet').empty();
          jQuery('#codeSnippet').append(snippetStr);


          //Call .doLogin API
          agent.doLogin(userName, password, protocol, serverIP, resource, "2.32.5", function (response) {
            if (response.State == "SUCCESS") {
              jQuery('#notification').val("Login Success");
            }
            else {
              jQuery('#notification').val("Login Failed");
            }
          });
        }

        //logout
        //Call .doLogout API with callback as parameter
        //Callback will be called with response object {State:"SUCCESS/ERROR", Error: { Code: "", Desc: ""}}
        function logout() {
          var snippetStr = "<pre><U>Logout:</U><br><br>barcoAPI.doLogout(function (response) {<br>"
          snippetStr += "  if (response.State == 'SUCCESS') {<br>";
          snippetStr += "    console.log('Logout Success')<br>";
          snippetStr += "  }<br>";
          snippetStr += "  else {<br>"
          snippetStr += "    console.log('Logout Failed')<br>";
          snippetStr += "  }<br>"
          snippetStr += "});<br></pre>"
          jQuery('#codeSnippet').append(snippetStr);

          //Call .doLogout API
          agent.doLogout(function (response) {
            if (response.State == "SUCCESS") {
              jQuery('#notification').val("Logout Success");
            }
            else {
              jQuery('#notification').val("Logout Failed");
            }
          });
        }

        //getPorts
        //Call .getPortList API with following params
        //queryStr - string with all request parameters
        //Callback function
        //Callback function will be called back with 'status' and 'data' as parameters
        //status - 'success'/'error'
        //data - JSON object
        function getPorts() {
          var snippetStr = "<pre><U>Get Ports:</U><br><br>var queryStr = 'type=SrcPort&whereState=Ready,Unmanaged&selectFormat=BASICCONNECTIONINFO&wherePermissions=VIEWFROM';<br><br>";
          snippetStr += "barcoAPI.getPortList(queryStr, function (status, data) {<br>"
          snippetStr += "  if (status == 'success') {<br>";
          snippetStr += "    console.log('GetPort list Success')<br>";
          snippetStr += "  }<br>";
          snippetStr += "  else {<br>"
          snippetStr += "    console.log('GetPort list Failed')<br>";
          snippetStr += "  }<br>"
          snippetStr += "})<br>;</pre>"
          jQuery('#codeSnippet').append(snippetStr);

          //Call .getPortList API
          var queryStr = 'type=SrcPort&subscriptionID=a1b2c3d4&subscriptionScope=ALLNODES&whereState=Ready,Unmanaged&selectFormat=BASICCONNECTIONINFO&wherePermissions=VIEWFROM';
          agent.getPortList(queryStr, function (status, data) {
            if (status == "success") {
              jQuery('#notification').val(JSON.stringify(data.Resource.Port, null, 4));
            }
            else {
              jQuery('#notification').val("Get Port failed");
            }
          });
        }

        //getAuthInfo
        //This will return authentication token which can be used to get the lists without login
        //call .getAuthInfo API with paramaters (userName, pwd, protocol, serverIP, resource)
        //Returns authentication token as object
        function getAuthInfo(userName, pwd, serverIP) {
          //Check for username
          var userName = jQuery('#txtUsername').val();
          if (jQuery.isBlank(userName)) {
            alert("Username cannot be empty");
            return
          }
          //Check for password
          var password = jQuery('#txtPwd').val();
          if (jQuery.isBlank(password)) {
            alert("Password cannot be empty");
            return
          }
          //Check for serverIP
          var serverIP = jQuery('#txtServer').val();
          if (jQuery.isBlank(serverIP)) {
            alert("Server IP cannot be empty");
            return
          }
          //Check for resource
          var resource = jQuery('#txtResource').val();
          if (jQuery.isBlank(resource)) {
            alert("Resource cannot be empty");
            return
          }

          var snippetStr = "<pre><U>Get AuthInfo:</U><br><br>var authToken = barcoAPI.getAuthInfo(userName, password, protocol, serverIP, resource);<br></pre>"
          jQuery('#codeSnippet').append(snippetStr);

          //call .getAuthInfo API
          authToken = agent.getAuthInfo(userName, password, protocol, serverIP, resource);
          jQuery('#notification').val(JSON.stringify(authToken, null, 4));
        }

        //getPortsWithToken
        //This can be used to get the port list without login into system but with authToken
        function getPortsWithToken() {
          var snippetStr = "<pre><U>Get Ports:</U><br>var queryStr = 'type=SrcPort&whereState=Ready,Unmanaged&selectFormat=BASICCONNECTIONINFO&wherePermissions=VIEWFROM';<br><br>";
          snippetStr += "barcoAPI.getPortListWithAuthToken(queryStr, authToken, function (status, data) {<br>"
          snippetStr += "  if (status == 'success') {<br>";
          snippetStr += "    console.log('GetPort list Success')<br>";
          snippetStr += "  }<br>";
          snippetStr += "  else {<br>"
          snippetStr += "    console.log('GetPort list Failed')<br>";
          snippetStr += "  }<br>"
          snippetStr += "});</pre>"
          jQuery('#codeSnippet').append(snippetStr);


          var queryStr = 'type=SrcPort&subscriptionID=a1b2c3d4&subscriptionScope=ALLNODES&whereState=Ready,Unmanaged&selectFormat=BASICCONNECTIONINFO&wherePermissions=VIEWFROM';
          //call .getPortListWithAuthToken API
          agent.getPortListWithAuthToken(queryStr, authToken, null, null, function (status, data) {
            if (status == "success") {
              jQuery('#notification').val(JSON.stringify(data.Resource.Port, null, 4));
            }
            else {
              jQuery('#notification').val("Get Port failed");
            }
          });
        }

        
        jQuery('#btnLogin').on('click', login);
        jQuery('#btnLogout').on('click', logout);
        jQuery('#btnGetPort').on('click', getPorts);        
        jQuery('#btnGetAuthInfo').on('click', getAuthInfo);
        jQuery('#btnGetPortWithToken').on('click', getPortsWithToken);
      });
	</script>
  </body>
</html>

