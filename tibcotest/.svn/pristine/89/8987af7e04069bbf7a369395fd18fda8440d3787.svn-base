<html>
  <head>
      <hta:application innerborder="no" caption="yes" applicationname="IPVS_AuthTool" singleinstance ="yes" icon="ipvs_admin.ico" />
      <script>
        var HTAPid = null;
        var shell = new ActiveXObject('WScript.Shell');
        var fso = new ActiveXObject('Scripting.FileSystemObject');
        var filename = "processIDs.txt";
        var folderBool = fso.FileExists(filename); ;
        if (folderBool) {
          fso.DeleteFile(filename);
          //alert("DEBUG:delete:" + filename);
        }
        var cmd = "cmd /c tasklist /FI \"IMAGENAME eq mshta.exe\" /FO \"CSV\" >> " + filename;
        var execStr = shell.Run(cmd, 0, true);
        // Open the file for input.
        var f = fso.OpenTextFile(filename, 1);
        var pidTxt = f.ReadAll();
        f.Close();
        var pidTxtArr = pidTxt.split(',');
        //alert("DEBUG:arr.length:"+pidTxtArr.length);
        var currentHTAPid = null;
        var HTAPid = null;
        for (i = pidTxtArr.length - 1; i > 0; i--) {
          //alert("DEBUG:pidTxtArr["+i+"]:"+pidTxtArr[i]);
          if (pidTxtArr[i].search("\"mshta.exe\"") > 0) {
            //alert("DEBUG:pidTxtArr:"pidTxtArr[i + 1]);
            currentHTAPid = pidTxtArr[i + 1];
            HTAPid = /\d+/.exec(currentHTAPid)[0];
            HTAPid = parseInt(HTAPid);
            break;
          }
        }
        //alert("DEBUG:HTAPid:"+HTAPid);
      </script>
  </head>
 <body BGCOLOR="#9898a5" SCROLL="no" style="position:absolute;width:100%;height:100%;left:0px;top:0px;padding:0px;margin:0px;border:0px;overflow:hidden;">
	<div id="jsxmain" style="position:absolute;left:0px;top:0px;width:100%;height:100%;">
	  <script type="text/javascript" src="JSX/js/JSX30.js"
		  jsxapppath="JSXAPPS/IPVS_AuthTool/"
		  jsx_logger_config="JSXAPPS/IPVS_AuthTool/logger.xml"
		  >
	  </script>
	</div>
</body>
</html>

