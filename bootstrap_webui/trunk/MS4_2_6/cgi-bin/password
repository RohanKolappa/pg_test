#!/usr/bin/haserl
<?
source /usr/share/bweb/localui/bweb_localui.sh

bweb_header 1
?>
<script type="text/javascript">
$(document).ready(function() {
 $("#passwordform").validate({
   rules: {
     newpassword: {
       required: true,
       minlength: 4
     },
     confirmpassword: {
       required: true,
       minlength: 4,
       equalTo: "#newpassword"
     }
   },
   messages: {
     newpassword: {
       required: "Please provide a password",
       minlength: "Must be at least 4 characters long"
     },
     confirmpassword: {
       required: "Please provide a password",
       minlength: "Must be at least 4 characters long",
       equalTo: "Must be the same as above"
     }
   }});
});
</script>
<style type="text/css">
#passwordform label.error { margin-left: 10px; color: red; }
</style>

<h1>Change <? echo -n $bweb_auth_user ?> password</h1>

<form method="post" id="passwordform">
<p>
<table>
<tr>
 <td width="150">New password:</td>
 <td><input type="password" id="newpassword" name="newpassword"></td>
</tr>
<tr>
 <td>Confirm new password:</td>
 <td><input type="password" name="confirmpassword"></td>
</tr>
</table>
<input type="submit" value="Change">
</form>

<? [ -n "$POST_newpassword" ] && MSG="Password successfully updated"$BWEB_EXTRA_PWD_CHANGE_MSG ?>

<?
if [ $bweb_auth_level -gt 1 ]; then

if [ -n "$POST_resetpasswords" ]; then
   if _bweb_auth_reset_passwords;
   then
     MSG="Passwords successfully reset to factory defaults"$BWEB_EXTRA_PWD_CHANGE_MSG;
   else
     MSG="Password reset failed (error $?)"
   fi
fi
?>

<p>
<br>
<p>

<h1>Reset all passwords</h1>
<form method="post" id="resetform">
<input type="hidden" name="resetpasswords" value="1">
This will reset all passwords up to <? echo -n $bweb_auth_user ?> level to the factory default values.<br>
<input type="submit" value="Reset">
</form>
<? fi ?>

<? if [ -n "$MSG" ]; then ?>
<script type="text/javascript">
$(document).ready(function() {
 $("#dialog").dialog({
	bgiframe: true,
	modal: true,
	draggable: false,
	resizable: false,
	show: 'scale',
	hide: 'scale',
	buttons: {
	  Ok: function() { $(this).dialog("close"); }
        }
 });
});
</script>
<div id="dialog" style="display:none">
<h2><center><? echo -n $MSG ?></center></h2>
</div>
<? fi ?>

<? bweb_footer ?>
