<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" 
    "C:/docbook/docbook-xml-4.5/docbookx.dtd" [
  <!ENTITY SessionObjectXML SYSTEM "Session.xml">
  <!ENTITY SessionObjectXSD SYSTEM "Session.xsd">
]>
<?xml-stylesheet type='text/xsl' 
    href='http://docbook.sourceforge.net/release/xsl/current/html/docbook.xsl'?>
<book status="draft">
	<bookinfo>
		<title>IPVS DeviceAdminAgent API</title>
		<revhistory>
			<revision>
				<revnumber>0.0.1</revnumber>
				<date>19 Jun 2012</date>
				<revremark>First Version of Device Agent API</revremark>
			</revision>
		</revhistory>
	</bookinfo>
	<glossary>
		<glossentry>
			<glossterm>AppController</glossterm>
			<glossdef>
				<para>
					AppController running on managementserver. Controller will manage all modules of the system.
        </para>
			</glossdef>
		</glossentry>
		<glossentry>
			<glossterm>DeviceAdminManager</glossterm>
			<glossdef>
				<para>
					DeviceAdminManager Running on Appserver. Manager will do policy check of device requests and send the requests to DeviceAgent
        </para>
			</glossdef>
		</glossentry>
		<glossentry>
			<glossterm>DeviceAdminAgent</glossterm>
			<glossdef>
				<para>
					DeviceAdminAgent Running on Device. Handles the Request from DeviceAdminManager or Internal DeviceServer.
        </para>
			</glossdef>
		</glossentry>
		<glossentry>
			<glossterm>DeviceAdminServer</glossterm>
			<glossdef>
				<para>
					DeviceAdminServer Running on Device. Which will send or receive commands or responses from JBUS/proxyclient/cli.
        </para>
			</glossdef>
		</glossentry>
	</glossary>
	<preface>
		<title>Introduction</title>
		<para>
			This document contains the IPVS Device Admin Agent API. Agent will accept requests from AppController/Clients or internal DeviceAdminServer
    </para>
	</preface>

	<chapter>
		<title>Discovery API</title>
		<para>
			API Calls used in Discovery process
    </para>

		<section>
			<title>External API</title>
			<para> Requests Received from DeviceAdminManager or Clients</para>
			<section>
				<title>GetDevice</title>
				<para> Returns the Device information in RAW format.</para>
				<example>
					<title>GetDeviceRequest</title>
					<programlisting>
          <![CDATA[  
   <GetDevice selectFormat='RAW' />
]]>
        </programlisting>
				</example>
				<example>
					<title>GetDeviceResponse</title>
					<programlisting>
          <![CDATA[  
   <GetDevice from='0' total='0'>
		<Device  title='' type='' state='' password='' ownerUserJID=''>				
			<Groups />
			<DevicePrivateData />
			<TemplateNID />
			<PortList />					
			<DeviceConfig> <!-- Device specific response --> </DeviceConfig>
			<DeviceStatus> <!-- Device specific response --> </DeviceStatus>
			<DeviceList />
		</Device>			
	</GetDevice>
]]>
        </programlisting>
				</example>
			</section>
			<section>
				<title>SetDeviceConfig</title>
				<para> update the device with given config</para>
				<example>
					<title>SetDeviceConfigRequest</title>
					<programlisting>
          <![CDATA[  
   <SetDeviceConfig doNotSaveToFlash='true/false'>
	  <DeviceConfig Dirty="CLEAN">
            <ServiceElementsConfig>
              <XMPPAgentServiceConfig Dirty="MODIFY">
                    <Enable>true</Enable>
                    <XMPPServer>0.0.0.0</XMPPServer>
                    <DeviceName>xp2001</DeviceName>
                    <DevicePassword>Ipvs1234</DevicePassword>
                    <Domain>default</Domain>
                    <ServiceDomain>default</ServiceDomain>
              </XMPPAgentServiceConfig>
              <NetworkElementsConfig>
                 <RouteTableConfig Dirty="MODIFY">
                   <RouteEntry Dirty="MODIFY" ListIndex="1">
                         <Destination>0.0.0.0</Destination>
                         <Netmask>0.0.0.0</Netmask>
                         <Gateway>192.168.1.1</Gateway>
                   </RouteEntry>
                 </RouteTableConfig>
                 <EthernetPortTableConfig>
                   <EthernetPortConfig Dirty="MODIFY" ListIndex="1">
                         <PortID>1</PortID>
                         <EnableInterface>true</EnableInterface>
                               <IsPrimary>true</IsPrimary>
                               <EnableMulticast>false</EnableMulticast>
                         <IPConfig>
                               <UseDHCP>false</UseDHCP>
                               <IPAddress>192.168.1.196</IPAddress>
                               <Netmask>255.255.0.0</Netmask>
                         </IPConfig>
                   </EthernetPortConfig>
            	 </EthernetPortTableConfig>
      		 </NetworkElementsConfig>
       	 </ServiceElementsConfig>
	  </DeviceConfig>
	</SetDeviceConfig>
]]>
        </programlisting>
				</example>
				<example>
					<title>SetDeviceConfigResponse</title>
					<programlisting>
          <![CDATA[  
   <SetDeviceConfig/>
]]>
        </programlisting>
				</example>
			</section>
		</section>
		<section>
			<title>Internal API</title>
			<para> Requests Received from DeviceAdminServer</para>
		</section>
	</chapter>

	<chapter>
		<title>Startup API</title>
		<para>
			API Calls used on device startup
    </para>
		<section>
			<title>External API</title>
			<para> Requests Received from DeviceAdminManager or Clients</para>
		</section>

		<section>
			<title>Internal API</title>
			<para> Requests Received from DeviceAdminClient</para>
			<section>
				<title>GetPublishInfo</title>
				<para> Returns the Device information Which needs to be published to appserver </para>
				<example>
					<title>GetPublishInfoRequest</title>
					<programlisting>
          <![CDATA[  
   <GetPublishInfo/>
]]>
        </programlisting>
				</example>
				<example>
					<title>GetPublishInfoResponse</title>
					<programlisting>
          <![CDATA[  
   <GetPublishInfo>
		<Device ownerUserJID=''>
			<PortList>
			   <Port portID='' portType=''/>
			</PortList>					
			<DeviceConfig> <!-- Device specific response --> </DeviceConfig>
			<DeviceStatus> <!-- Device specific response --> </DeviceStatus>
		</Device>			
	</GetPublishInfo>
]]>
        </programlisting>
				</example>
			</section>
		</section>
	</chapter>

	<chapter>
		<title>DeviceConfig API</title>
		<para>
			API Calls used to update Device Config From Clients/AppControler or publish the Config to App Controler
       </para>

		<section>
			<title>External API</title>
			<para> Requests Received from DeviceAdminManager or Clients</para>
			<section>
				<title>SetDeviceConfig</title>
				<para> Set the given Config input</para>
				<example>
					<title>SetDeviceConfigRequest</title>
					<programlisting>
          <![CDATA[  
  	   <SetDeviceConfig doNotSaveToFlash='true/false'>
		  <DeviceConfig Dirty="CLEAN">
		      <SystemElementsConfig Dirty="CLEAN">
		         <!-- Choice of device specific  System Info -->
		      </SystemElementsConfig>
		      <ServiceElementsConfig Dirty="CLEAN">
		         <!-- Choice of device specific  Services-->
		      </ServiceElementsConfig>
		      <NetworkElementsConfig Dirty="CLEAN">
		         <!-- Network Config Common for all devices-->
		      </NetworkElementsConfig>
		       <StorageElementsConfig Dirty="CLEAN">
		         <!-- Common for all DMS and MS Devices-->
		      </StorageElementsConfig>
		      <AVCodecElementsConfig Dirty="CLEAN">
		         <!-- Choice of device specific  AVCodec Elements -->
		      </AVCodecElementsConfig>
		  </DeviceConfig>
		</SetDeviceConfig>
]]>
        </programlisting>
				</example>
				<example>
					<title>SetDeviceConfigResponse</title>
					<programlisting>
          <![CDATA[  
   <SetDeviceConfig/>
]]>
        </programlisting>
				</example>
				<example>
					<title>Enable DHCP to get local ipaddress</title>
					<programlisting>
          <![CDATA[  
  	   <SetDeviceConfig doNotSaveToFlash='true/false'>
		  <DeviceConfig Dirty="CLEAN">
		       <NetworkElementsConfig Dirty="CLEAN">
		         <EthernetPortTableConfig>
		            <EthernetPortConfig Dirty="MODIFY" ListIndex="1">
		               <PortID>1</PortID>
		               <EnableInterface>true</EnableInterface>
		               <IsPrimary>true</IsPrimary>
		               <EnableMulticast>true</EnableMulticast>
		               <MTU>1500</MTU>
		
		               <IPConfig>
		                  <UseDHCP>true</UseDHCP>
		                  <IPAddress>169.254.0.1</IPAddress>
		                  <Netmask>255.255.0.0</Netmask>
		               </IPConfig>
		            </EthernetPortConfig>
		         </EthernetPortTableConfig>
		      </NetworkElementsConfig>		      
		  </DeviceConfig>
		</SetDeviceConfig>
]]>
        </programlisting>
				</example>
			</section>
		</section>

		<section>
			<title>Internal API</title>
			<para> Requests Received from DeviceAdminClient</para>
			<section>
				<title>PublishDeviceConfig</title>
				<para> Sends Request to appserver to update DeviceConfig in database  </para>
				<example>
					<title>Publish the DHCP config to AppController</title>
					<programlisting>
          <![CDATA[  
  <PublishDeviceConfig  byNID='1234' xpath='//EthernetPortConfig' operation='UPDATE'>
	 <EthernetPortConfig Dirty="CLEAN" ListIndex="1">
         <PortID>1</PortID>
         <EnableInterface>true</EnableInterface>
         <IsPrimary>true</IsPrimary>
         <EnableMulticast>true</EnableMulticast>
         <MTU>1500</MTU>

         <IPConfig>
            <UseDHCP>true</UseDHCP>
            <IPAddress>169.254.0.1</IPAddress>
            <Netmask>255.255.0.0</Netmask>
         </IPConfig>
      </EthernetPortConfig>   
	</PublishDeviceConfig>
]]>
        </programlisting>
				</example>
				<example>
					<title>PublishDeviceConfigResponse</title>
					<programlisting>
          <![CDATA[  
  <PublishDeviceConfig/>
]]>
        </programlisting>
				</example>
			</section>
		</section>
	</chapter>


	<chapter>
		<title>DeviceStatus API</title>
		<para>
			API Calls used to publish the device status to AppController
       </para>

		<section>
			<title>External API</title>
			<para> Requests Received from DeviceAdminManager</para>
			<section>
				<title>GetDynamicDeviceStatus</title>
				<para> Returns current status of device</para>
				<example>
					<title>GetDynamicDeviceStatusRequest</title>
					<programlisting>
          <![CDATA[  
  	  <GetDynamicDeviceStatus selectFormat='RAW'/>
]]>
        </programlisting>
				</example>
				<example>
					<title>GetDynamicDeviceStatusResponse</title>
					<programlisting>
          <![CDATA[  
   <GetDynamicDeviceStatus>
		<DeviceStatus Dirty="CLEAN">
			<SystemElementsStatus Dirty="CLEAN">
				<!-- Choice of device specific System Status -->
			</SystemElementsStatus>
			<ServiceElementsStatus Dirty="CLEAN">
				<!-- Choice of device specific Services status -->
			</ServiceElementsStatus>
			<NetworkElementsStatus Dirty="CLEAN">
				<NATZoneTableStatus Queryable="true" State="OK">
					<ParametersList>
						<Parameters>
							<Parameter name="" type="Float" units="" source=""></Parameter>
						</Parameters>
					</ParametersList>
				</NATZoneTableStatus>
				<EthernetPortTableStatus>
					<EthernetPortStatus Queryable="true" State="OK">
						<ParametersList>
							<Parameters>
								<Parameter name="" type="Float" units="" source=""></Parameter>
							</Parameters>
						</ParametersList>
					</EthernetPortStatus>
				</EthernetPortTableStatus>
				<!-- Network Status Common for all devices -->
			</NetworkElementsStatus>
			<StorageElementsStatus Dirty="CLEAN">
				<!-- Common for all DMS and MS Devices -->
			</StorageElementsStatus>
			<AVCodecElementsStatus Dirty="CLEAN">
				<!-- Choice of device specific AVCodec Elements -->
			</AVCodecElementsStatus>
		</DeviceStatus>
	</GetDynamicDeviceStatus>
]]>
        </programlisting>
				</example>
			</section>
		</section>

		<section>
			<title>Internal API</title>
			<para> Requests Received from DeviceAdminServer</para>
			<section>
				<title>
					PublishDeviceStatus</title>
				<para>
					Sends Request to appserver to update DeviceStatus in database
      </para>
				<example>
					<title>Publishing network status to appserver</title>
					<programlisting>
          <![CDATA[  
  <PublishDeviceStatus  byNID='1234' xpath='//EthernetPortTableStatus' operation='UPDATE'>
	   <EthernetPortTableStatus>
            <EthernetPortStatus Queryable="true" State="OK">
               <ParametersList>
                  <Parameters>
                     <Parameter name="" type="Float" units="" source=""></Parameter>
                  </Parameters>
               </ParametersList>
            </EthernetPortStatus>
         </EthernetPortTableStatus>  
	</PublishDeviceStatus>
]]>
        </programlisting>
				</example>
				<example>
					<title>PublishDevicStatusResponse</title>
					<programlisting>
          <![CDATA[  
  <PublishDeviceStatus/>
]]>
        </programlisting>
				</example>
			</section>
		</section>
	</chapter>


	<chapter>
		<title>DeviceCommand API</title>
		<para>
			API Calls used to Run commands on devices like Upgrade,Reboot,RevertDefault, SaveToFlash
       </para>

		<section>
			<title>External API</title>
			<para> Requests Received from DeviceAdminManager</para>
			<section>
				<title>ExecuteDeviceCommand</title>
				<para> Execute the given action</para>
				<example>
					<title>ExecuteDeviceCommandRequest</title>
					<programlisting>
          <![CDATA[  
  	  <ExecuteDeviceCommand command='UPGRADE/REBOOT/REVERTDEFAULT/SAVE'>
  	   <CommandParam name='' value=''/>
  	   <CommandParam name='' value=''/>
  	   <CommandParam name='' value=''/>
  	  </ExecuteDeviceCommand>
]]>
        </programlisting>
				</example>
				<example>
					<title>ExecuteDeviceCommandResponse</title>
					<programlisting>
          <![CDATA[  
   <ExecuteDeviceCommand/>
]]>
        </programlisting>
				</example>
			</section>
		</section>

		<section>
			<title>Internal API</title>
			<para> Requests Received from DeviceAdminServer</para>
		</section>
	</chapter>
</book>